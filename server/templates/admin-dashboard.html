<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>CryptoEats Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0A0A0F;
      --surface: #14141F;
      --surface-hover: #1A1A2E;
      --border: #1E1E30;
      --accent: #00D4AA;
      --accent-dim: rgba(0, 212, 170, 0.15);
      --text: #E8E8ED;
      --text-secondary: #8888A0;
      --danger: #FF4D6A;
      --warning: #FFB84D;
      --success: #00D4AA;
      --info: #4D9DFF;
      --purple: #A855F7;
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .layout {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: 100vh;
    }

    .sidebar {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 24px 0;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .sidebar-brand {
      padding: 0 24px 24px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 8px;
    }

    .sidebar-brand h1 {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .sidebar-brand span {
      font-size: 12px;
      color: var(--text-secondary);
      display: block;
      margin-top: 4px;
    }

    .logout-btn {
      margin: auto 16px 16px;
      padding: 10px 16px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.2s;
    }
    .logout-btn:hover { border-color: var(--danger); color: var(--danger); }

    .nav-section {
      padding: 12px 24px 6px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 11px 24px;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }

    .nav-item:hover { background: var(--surface-hover); color: var(--text); }
    .nav-item.active { color: var(--accent); background: var(--accent-dim); border-right: 3px solid var(--accent); }

    .nav-item svg { width: 18px; height: 18px; flex-shrink: 0; }

    .sidebar-footer {
      margin-top: auto;
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      font-size: 12px;
      color: var(--text-secondary);
    }

    .main-content {
      padding: 32px;
      overflow-y: auto;
      max-height: 100vh;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
    }

    .page-header h2 {
      font-size: 24px;
      font-weight: 700;
    }

    .page-header .refresh-info {
      font-size: 12px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .refresh-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 16px;
      margin-bottom: 28px;
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: border-color 0.2s;
    }

    .stat-card:hover { border-color: var(--accent); }

    .stat-card .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .stat-card .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-card .stat-icon svg { width: 20px; height: 20px; }
    .stat-card .stat-icon.green { background: rgba(0,212,170,0.15); color: var(--success); }
    .stat-card .stat-icon.blue { background: rgba(77,157,255,0.15); color: var(--info); }
    .stat-card .stat-icon.yellow { background: rgba(255,184,77,0.15); color: var(--warning); }
    .stat-card .stat-icon.purple { background: rgba(168,85,247,0.15); color: var(--purple); }
    .stat-card .stat-icon.red { background: rgba(255,77,106,0.15); color: var(--danger); }

    .stat-card .label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .stat-card .value {
      font-size: 28px;
      font-weight: 700;
      margin-top: 4px;
    }

    .stat-card .sub {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      text-align: left;
      padding: 10px 12px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid var(--border);
    }

    td {
      padding: 12px;
      font-size: 14px;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }

    tr:last-child td { border-bottom: none; }
    tr:hover td { background: var(--surface-hover); }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-success { background: rgba(0,212,170,0.15); color: var(--success); }
    .badge-warning { background: rgba(255,184,77,0.15); color: var(--warning); }
    .badge-danger { background: rgba(255,77,106,0.15); color: var(--danger); }
    .badge-info { background: rgba(77,157,255,0.15); color: var(--info); }
    .badge-neutral { background: rgba(136,136,160,0.15); color: var(--text-secondary); }
    .badge-purple { background: rgba(168,85,247,0.15); color: var(--purple); }

    .filter-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
      align-items: center;
    }

    .filter-bar label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    select.filter-select {
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      font-family: inherit;
      cursor: pointer;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      outline: none;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238888A0' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 30px;
    }

    select.filter-select:focus { border-color: var(--accent); }

    .restaurant-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .restaurant-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: border-color 0.2s;
    }

    .restaurant-card:hover { border-color: var(--accent); }

    .restaurant-card .r-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .restaurant-card .r-name {
      font-size: 16px;
      font-weight: 600;
    }

    .restaurant-card .r-cuisine {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 2px;
    }

    .restaurant-card .r-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 14px;
    }

    .restaurant-card .r-stat-label {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .restaurant-card .r-stat-value {
      font-size: 15px;
      font-weight: 600;
      margin-top: 2px;
    }

    .compliance-list {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .compliance-item {
      display: grid;
      grid-template-columns: auto 1fr auto auto;
      gap: 16px;
      align-items: center;
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
    }

    .compliance-item:last-child { border-bottom: none; }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-dot.green { background: var(--success); }
    .status-dot.yellow { background: var(--warning); }
    .status-dot.red { background: var(--danger); }
    .status-dot.blue { background: var(--info); }

    .budget-section { margin-bottom: 28px; }

    .budget-total {
      font-size: 36px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .budget-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .budget-bars { display: flex; flex-direction: column; gap: 16px; }

    .budget-bar-item { display: flex; flex-direction: column; gap: 6px; }

    .budget-bar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    .budget-bar-header .bar-label { font-weight: 500; }
    .budget-bar-header .bar-amount { color: var(--text-secondary); font-weight: 600; }

    .budget-bar-track {
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
    }

    .budget-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.6s ease;
    }

    .pie-chart-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 32px;
      flex-wrap: wrap;
    }

    .pie-chart {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      position: relative;
    }

    .pie-legend {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .pie-legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .pie-legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .service-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
    }

    .service-item:last-child { border-bottom: none; }

    .service-label { color: var(--text-secondary); }

    .loading-skeleton {
      background: linear-gradient(90deg, var(--surface) 25%, var(--surface-hover) 50%, var(--surface) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
      height: 20px;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .loading-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .loading-card .loading-skeleton { margin-bottom: 12px; }
    .loading-card .loading-skeleton:last-child { margin-bottom: 0; width: 60%; }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-secondary);
    }

    .empty-state svg { width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.4; }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 14px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: var(--success); color: #0A0A0F; }
    .toast.error { background: var(--danger); color: #fff; }

    .table-wrapper { overflow-x: auto; }

    @media (max-width: 768px) {
      .layout { grid-template-columns: 1fr; }
      .sidebar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: auto;
        z-index: 100;
        flex-direction: row;
        overflow-x: auto;
        padding: 0;
        border-right: none;
        border-top: 1px solid var(--border);
      }
      .sidebar-brand, .nav-section, .sidebar-footer { display: none; }
      .nav-item {
        flex-direction: column;
        padding: 10px 14px;
        font-size: 10px;
        gap: 4px;
        white-space: nowrap;
        min-width: fit-content;
      }
      .nav-item.active { border-right: none; border-top: 2px solid var(--accent); }
      .main-content { padding: 20px; padding-bottom: 80px; max-height: none; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .restaurant-grid { grid-template-columns: 1fr; }
      .pie-chart-container { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <nav class="sidebar">
      <div class="sidebar-brand">
        <h1>
          <img src="/public/images/logo.png" alt="CryptoEats" style="width:32px;height:32px;border-radius:6px;vertical-align:middle;" />
          CryptoEats
        </h1>
        <span>Admin Dashboard</span>
      </div>
      <div class="nav-section">Main</div>
      <button class="nav-item active" onclick="switchTab('overview')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Overview
      </button>
      <button class="nav-item" onclick="switchTab('orders')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><path d="M9 14l2 2 4-4"/></svg>
        Orders
      </button>
      <button class="nav-item" onclick="switchTab('restaurants')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
        Restaurants
      </button>
      <button class="nav-item" onclick="switchTab('drivers')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M20 21a8 8 0 00-16 0"/></svg>
        Drivers
      </button>
      <div class="nav-section">Management</div>
      <button class="nav-item" onclick="switchTab('compliance')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
        Compliance
      </button>
      <button class="nav-item" onclick="switchTab('budget')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
        Pilot Budget
      </button>
      <button class="nav-item" onclick="switchTab('settings')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
        Settings
      </button>
      <button class="logout-btn" onclick="logout()">Sign Out</button>
      <div class="sidebar-footer">
        <div style="display:flex;align-items:center;gap:6px;">
          <span class="refresh-dot"></span>
          <span id="sidebar-status">Live</span>
        </div>
      </div>
    </nav>

    <main class="main-content">

      <div id="tab-overview" class="tab-content active">
        <div class="page-header">
          <h2>Overview</h2>
          <span class="refresh-info"><span class="refresh-dot"></span> <span id="last-refresh">Auto-refresh: 30s</span></span>
        </div>
        <div class="stats-grid" id="overview-stats">
          <div class="loading-card"><div class="loading-skeleton" style="height:14px;width:40%"></div><div class="loading-skeleton" style="height:28px;width:60%"></div><div class="loading-skeleton" style="height:12px;width:30%"></div></div>
          <div class="loading-card"><div class="loading-skeleton" style="height:14px;width:40%"></div><div class="loading-skeleton" style="height:28px;width:60%"></div><div class="loading-skeleton" style="height:12px;width:30%"></div></div>
          <div class="loading-card"><div class="loading-skeleton" style="height:14px;width:40%"></div><div class="loading-skeleton" style="height:28px;width:60%"></div><div class="loading-skeleton" style="height:12px;width:30%"></div></div>
          <div class="loading-card"><div class="loading-skeleton" style="height:14px;width:40%"></div><div class="loading-skeleton" style="height:28px;width:60%"></div><div class="loading-skeleton" style="height:12px;width:30%"></div></div>
        </div>
        <div class="card">
          <div class="card-title">Recent Orders</div>
          <div id="recent-orders-table"><div class="loading-skeleton" style="height:200px"></div></div>
        </div>
      </div>

      <div id="tab-orders" class="tab-content">
        <div class="page-header">
          <h2>Orders</h2>
        </div>
        <div class="filter-bar">
          <label>Status:</label>
          <select class="filter-select" id="order-status-filter" onchange="renderOrders()">
            <option value="all">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="preparing">Preparing</option>
            <option value="picked_up">Picked Up</option>
            <option value="in_transit">In Transit</option>
            <option value="delivered">Delivered</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        <div class="card">
          <div class="table-wrapper" id="orders-table"><div class="loading-skeleton" style="height:300px"></div></div>
        </div>
      </div>

      <div id="tab-restaurants" class="tab-content">
        <div class="page-header">
          <h2>Restaurants</h2>
        </div>
        <div class="restaurant-grid" id="restaurants-grid"><div class="loading-card"><div class="loading-skeleton" style="height:150px"></div></div></div>
      </div>

      <div id="tab-drivers" class="tab-content">
        <div class="page-header">
          <h2>Drivers</h2>
        </div>
        <div class="card">
          <div class="table-wrapper" id="drivers-table"><div class="loading-skeleton" style="height:300px"></div></div>
        </div>
      </div>

      <div id="tab-compliance" class="tab-content">
        <div class="page-header">
          <h2>Compliance</h2>
        </div>
        <div class="card">
          <div class="card-title">Recent Compliance Logs</div>
          <div id="compliance-logs"><div class="loading-skeleton" style="height:200px"></div></div>
        </div>
      </div>

      <div id="tab-budget" class="tab-content">
        <div class="page-header">
          <h2>Pilot Budget</h2>
        </div>
        <div class="card budget-section">
          <div class="budget-total" id="budget-total">$19,745</div>
          <div class="budget-subtitle">Total Pilot Budget Allocation</div>
          <div class="budget-bars" id="budget-bars"></div>
        </div>
        <div class="card">
          <div class="card-title">Budget Distribution</div>
          <div class="pie-chart-container" id="pie-chart-area"></div>
        </div>
      </div>

      <div id="tab-settings" class="tab-content">
        <div class="page-header">
          <h2>Settings</h2>
        </div>
        <div class="settings-grid" id="settings-content">
          <div class="loading-card"><div class="loading-skeleton" style="height:200px"></div></div>
          <div class="loading-card"><div class="loading-skeleton" style="height:200px"></div></div>
        </div>
      </div>

    </main>
  </div>

  <div id="login-overlay" style="position:fixed;inset:0;background:#0A0A0F;z-index:10000;display:flex;align-items:center;justify-content:center;">
    <div style="width:100%;max-width:400px;padding:40px;background:#14141F;border-radius:16px;border:1px solid #1E1E30;">
      <div style="text-align:center;margin-bottom:24px;">
        <h1 style="color:#00D4AA;font-size:24px;margin-bottom:4px;">CryptoEats</h1>
        <p style="color:#8888A0;font-size:14px;">Admin Dashboard Login</p>
      </div>
      <div id="login-error" style="display:none;background:rgba(255,77,106,0.15);border:1px solid #FF4D6A;color:#FF4D6A;padding:12px;border-radius:8px;margin-bottom:16px;font-size:13px;"></div>
      <form id="login-form" onsubmit="handleLogin(event)">
        <div style="margin-bottom:16px;">
          <label style="display:block;font-size:13px;color:#8888A0;margin-bottom:6px;">Email</label>
          <input id="login-email" type="email" required placeholder="admin@cryptoeats.net"
            style="width:100%;padding:12px 16px;background:#0A0A0F;border:1px solid #1E1E30;border-radius:8px;color:#E8E8ED;font-size:14px;outline:none;font-family:inherit;"
            onfocus="this.style.borderColor='#00D4AA'" onblur="this.style.borderColor='#1E1E30'">
        </div>
        <div style="margin-bottom:24px;">
          <label style="display:block;font-size:13px;color:#8888A0;margin-bottom:6px;">Password</label>
          <input id="login-password" type="password" required placeholder="Enter password"
            style="width:100%;padding:12px 16px;background:#0A0A0F;border:1px solid #1E1E30;border-radius:8px;color:#E8E8ED;font-size:14px;outline:none;font-family:inherit;"
            onfocus="this.style.borderColor='#00D4AA'" onblur="this.style.borderColor='#1E1E30'">
        </div>
        <button type="submit" id="login-btn"
          style="width:100%;padding:14px;background:#00D4AA;color:#0A0A0F;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;font-family:inherit;">
          Sign In
        </button>
      </form>
      <div id="forgot-section" style="display:none;">
        <div id="forgot-step-email">
          <p style="color:#8888A0;font-size:13px;margin-bottom:16px;">Enter your email and we'll send a 6-digit reset code.</p>
          <div style="margin-bottom:16px;">
            <label style="display:block;font-size:13px;color:#8888A0;margin-bottom:6px;">Email</label>
            <input id="forgot-email" type="email" required placeholder="admin@cryptoeats.net"
              style="width:100%;padding:12px 16px;background:#0A0A0F;border:1px solid #1E1E30;border-radius:8px;color:#E8E8ED;font-size:14px;outline:none;font-family:inherit;"
              onfocus="this.style.borderColor='#00D4AA'" onblur="this.style.borderColor='#1E1E30'">
          </div>
          <button onclick="sendResetCode('admin')" id="send-code-btn"
            style="width:100%;padding:14px;background:#00D4AA;color:#0A0A0F;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;font-family:inherit;">
            Send Reset Code
          </button>
        </div>
        <div id="forgot-step-code" style="display:none;">
          <div id="forgot-msg" style="background:rgba(0,212,170,0.15);border:1px solid #00D4AA;color:#00D4AA;padding:12px;border-radius:8px;margin-bottom:16px;font-size:13px;"></div>
          <div style="margin-bottom:16px;">
            <label style="display:block;font-size:13px;color:#8888A0;margin-bottom:6px;">6-Digit Code</label>
            <input id="reset-code" type="text" maxlength="6" placeholder="000000"
              style="width:100%;padding:12px 16px;background:#0A0A0F;border:1px solid #1E1E30;border-radius:8px;color:#E8E8ED;font-size:18px;letter-spacing:6px;text-align:center;outline:none;font-family:inherit;"
              onfocus="this.style.borderColor='#00D4AA'" onblur="this.style.borderColor='#1E1E30'"
              oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,6)">
          </div>
          <div style="margin-bottom:16px;">
            <label style="display:block;font-size:13px;color:#8888A0;margin-bottom:6px;">New Password</label>
            <input id="new-password" type="password" placeholder="At least 8 characters"
              style="width:100%;padding:12px 16px;background:#0A0A0F;border:1px solid #1E1E30;border-radius:8px;color:#E8E8ED;font-size:14px;outline:none;font-family:inherit;"
              onfocus="this.style.borderColor='#00D4AA'" onblur="this.style.borderColor='#1E1E30'">
          </div>
          <button onclick="resetPassword('admin')" id="reset-btn"
            style="width:100%;padding:14px;background:#00D4AA;color:#0A0A0F;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;font-family:inherit;">
            Reset Password
          </button>
        </div>
        <div id="forgot-error" style="display:none;background:rgba(255,77,106,0.15);border:1px solid #FF4D6A;color:#FF4D6A;padding:12px;border-radius:8px;margin-top:16px;font-size:13px;"></div>
      </div>
      <p id="forgot-link" style="text-align:center;margin-top:16px;font-size:13px;color:#00D4AA;cursor:pointer;" onclick="showForgotPassword()">Forgot Password?</p>
      <p id="back-link" style="text-align:center;margin-top:16px;font-size:13px;color:#00D4AA;cursor:pointer;display:none;" onclick="hideForgotPassword()">&#8592; Back to Sign In</p>
      <p style="text-align:center;margin-top:8px;font-size:12px;color:#8888A0;">Only authorized admin accounts can access this dashboard.</p>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    let authToken = localStorage.getItem('cryptoeats_admin_token');

    async function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const btn = document.getElementById('login-btn');
      const errEl = document.getElementById('login-error');
      btn.textContent = 'Signing in...';
      btn.disabled = true;
      errEl.style.display = 'none';
      try {
        const res = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password }),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.message || 'Login failed');
        if (data.user.role !== 'admin') throw new Error('Access denied. Admin accounts only.');
        authToken = data.token;
        localStorage.setItem('cryptoeats_admin_token', authToken);
        document.getElementById('login-overlay').style.display = 'none';
        init();
      } catch (err) {
        errEl.textContent = err.message;
        errEl.style.display = 'block';
      } finally {
        btn.textContent = 'Sign In';
        btn.disabled = false;
      }
    }

    function logout() {
      authToken = null;
      localStorage.removeItem('cryptoeats_admin_token');
      if (refreshInterval) clearInterval(refreshInterval);
      document.getElementById('login-overlay').style.display = 'flex';
      document.getElementById('login-email').value = '';
      document.getElementById('login-password').value = '';
      document.getElementById('login-error').style.display = 'none';
      hideForgotPassword();
    }

    function showForgotPassword() {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('forgot-section').style.display = 'block';
      document.getElementById('forgot-link').style.display = 'none';
      document.getElementById('back-link').style.display = 'block';
      document.getElementById('login-error').style.display = 'none';
      document.getElementById('forgot-email').value = document.getElementById('login-email').value;
    }

    function hideForgotPassword() {
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('forgot-section').style.display = 'none';
      document.getElementById('forgot-link').style.display = 'block';
      document.getElementById('back-link').style.display = 'none';
      document.getElementById('forgot-step-email').style.display = 'block';
      document.getElementById('forgot-step-code').style.display = 'none';
      document.getElementById('forgot-error').style.display = 'none';
    }

    async function sendResetCode() {
      const email = document.getElementById('forgot-email').value;
      const btn = document.getElementById('send-code-btn');
      const errEl = document.getElementById('forgot-error');
      errEl.style.display = 'none';
      btn.textContent = 'Sending...'; btn.disabled = true;
      try {
        const res = await fetch('/api/auth/forgot-password', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });
        const data = await res.json();
        document.getElementById('forgot-msg').textContent = data.message;
        document.getElementById('forgot-step-email').style.display = 'none';
        document.getElementById('forgot-step-code').style.display = 'block';
      } catch (err) {
        errEl.textContent = 'Failed to connect. Please try again.';
        errEl.style.display = 'block';
      } finally {
        btn.textContent = 'Send Reset Code'; btn.disabled = false;
      }
    }

    async function resetPassword() {
      const email = document.getElementById('forgot-email').value;
      const code = document.getElementById('reset-code').value;
      const newPw = document.getElementById('new-password').value;
      const btn = document.getElementById('reset-btn');
      const errEl = document.getElementById('forgot-error');
      errEl.style.display = 'none';
      if (newPw.length < 8) { errEl.textContent = 'Password must be at least 8 characters'; errEl.style.display = 'block'; return; }
      btn.textContent = 'Resetting...'; btn.disabled = true;
      try {
        const res = await fetch('/api/auth/reset-password', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, code, newPassword: newPw }),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.message || 'Reset failed');
        alert('Password reset successfully! You can now sign in.');
        hideForgotPassword();
      } catch (err) {
        errEl.textContent = err.message;
        errEl.style.display = 'block';
      } finally {
        btn.textContent = 'Reset Password'; btn.disabled = false;
      }
    }

    async function verifyToken() {
      if (!authToken) return false;
      try {
        const res = await fetch('/api/customers/profile', {
          headers: { 'Authorization': 'Bearer ' + authToken },
        });
        if (!res.ok) return false;
        const data = await res.json();
        return data.role === 'admin';
      } catch { return false; }
    }

    (async function checkAuth() {
      if (await verifyToken()) {
        document.getElementById('login-overlay').style.display = 'none';
        init();
      }
    })();

    const TAB_NAMES = ['overview', 'orders', 'restaurants', 'drivers', 'compliance', 'budget', 'settings'];
    let statsData = null;
    let ordersData = [];
    let restaurantsData = [];
    let driversData = [];
    let refreshInterval = null;

    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
      document.getElementById('tab-' + tab).classList.add('active');
      const navItems = document.querySelectorAll('.nav-item');
      const idx = TAB_NAMES.indexOf(tab);
      if (idx >= 0 && navItems[idx]) navItems[idx].classList.add('active');
    }

    function showToast(message, type) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type;
      setTimeout(() => toast.classList.add('show'), 10);
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    async function apiFetch(url) {
      try {
        const headers = { 'Content-Type': 'application/json' };
        if (authToken) headers['Authorization'] = 'Bearer ' + authToken;
        const res = await fetch(url, { headers });
        if (res.status === 401 || res.status === 403) { logout(); return null; }
        if (!res.ok) throw new Error('Request failed');
        return await res.json();
      } catch (e) {
        console.error('API Error:', url, e);
        return null;
      }
    }

    function formatCurrency(val) {
      const num = parseFloat(val);
      if (isNaN(num)) return '$0.00';
      return '$' + num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function formatNumber(val) {
      const num = parseInt(val);
      if (isNaN(num)) return '0';
      return num.toLocaleString('en-US');
    }

    function statusBadge(status) {
      const map = {
        approved: 'success', active: 'success', delivered: 'success', completed: 'success', verified: 'success', available: 'success',
        pending: 'warning', preparing: 'warning', pending_review: 'warning',
        suspended: 'danger', cancelled: 'danger', rejected: 'danger', failed: 'danger',
        picked_up: 'info', in_transit: 'info', assigned: 'info',
      };
      const cls = map[status] || 'neutral';
      const label = (status || 'N/A').replace(/_/g, ' ');
      return '<span class="badge badge-' + cls + '">' + label + '</span>';
    }

    function truncateId(id) {
      if (!id) return 'N/A';
      return id.length > 10 ? id.substring(0, 10) + '…' : id;
    }

    function formatDate(d) {
      if (!d) return 'N/A';
      return new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    async function fetchAllData() {
      const [stats, orders, restaurants, drivers] = await Promise.all([
        apiFetch('/api/admin/stats'),
        apiFetch('/api/admin/orders'),
        apiFetch('/api/admin/restaurants'),
        apiFetch('/api/admin/drivers'),
      ]);

      statsData = stats;
      ordersData = orders || [];
      restaurantsData = restaurants || [];
      driversData = drivers || [];

      renderAll();
      document.getElementById('last-refresh').textContent = 'Updated ' + new Date().toLocaleTimeString();
    }

    function renderAll() {
      renderOverview();
      renderOrders();
      renderRestaurants();
      renderDrivers();
      renderCompliance();
      renderBudget();
      renderSettings();
    }

    function renderOverview() {
      if (!statsData) return;
      const o = statsData.overview;
      const cards = [
        { label: 'Total Orders', value: formatNumber(o.totalOrders), icon: 'green', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/></svg>', sub: 'All time' },
        { label: 'Total Revenue', value: formatCurrency(o.totalRevenue), icon: 'green', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>', sub: 'All time' },
        { label: 'Avg Order Value', value: formatCurrency(o.avgOrderValue), icon: 'blue', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>', sub: 'Per order' },
        { label: "Today's Orders", value: formatNumber(o.todayOrders), icon: 'purple', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>', sub: 'Today' },
        { label: "Today's Revenue", value: formatCurrency(o.todayRevenue), icon: 'yellow', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>', sub: 'Today' },
        { label: 'Active Drivers', value: formatNumber(statsData.drivers.active), icon: 'blue', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M20 21a8 8 0 00-16 0"/></svg>', sub: 'Currently available' },
        { label: 'Approved Restaurants', value: formatNumber(statsData.restaurants.approved), icon: 'green', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h18v18H3z"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>', sub: statsData.restaurants.pending + ' pending' },
        { label: 'Total Tips', value: formatCurrency(o.totalTips), icon: 'yellow', svg: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 000-7.78z"/></svg>', sub: 'All time' },
      ];

      document.getElementById('overview-stats').innerHTML = cards.map(c =>
        '<div class="stat-card">' +
          '<div class="stat-header">' +
            '<div class="label">' + c.label + '</div>' +
            '<div class="stat-icon ' + c.icon + '">' + c.svg + '</div>' +
          '</div>' +
          '<div class="value">' + c.value + '</div>' +
          '<div class="sub">' + c.sub + '</div>' +
        '</div>'
      ).join('');

      const recent = ordersData.slice(0, 8);
      if (recent.length === 0) {
        document.getElementById('recent-orders-table').innerHTML = '<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="8" y1="9" x2="16" y2="9"/><line x1="8" y1="13" x2="13" y2="13"/></svg><p>No orders yet</p></div>';
        return;
      }

      document.getElementById('recent-orders-table').innerHTML =
        '<div class="table-wrapper"><table><thead><tr><th>Order ID</th><th>Status</th><th>Total</th><th>Payment</th><th>Date</th></tr></thead><tbody>' +
        recent.map(o =>
          '<tr><td style="font-family:monospace;font-size:12px">' + truncateId(o.id) + '</td><td>' + statusBadge(o.status) + '</td><td>' + formatCurrency(o.total) + '</td><td>' + (o.paymentMethod || 'N/A') + '</td><td>' + formatDate(o.createdAt) + '</td></tr>'
        ).join('') +
        '</tbody></table></div>';
    }

    function renderOrders() {
      const filter = document.getElementById('order-status-filter').value;
      const filtered = filter === 'all' ? ordersData : ordersData.filter(o => o.status === filter);

      if (filtered.length === 0) {
        document.getElementById('orders-table').innerHTML = '<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="8" y1="9" x2="16" y2="9"/><line x1="8" y1="13" x2="13" y2="13"/></svg><p>No orders found</p></div>';
        return;
      }

      document.getElementById('orders-table').innerHTML =
        '<table><thead><tr><th>Order ID</th><th>Status</th><th>Total</th><th>Payment</th><th>Delivery Address</th><th>Created</th></tr></thead><tbody>' +
        filtered.map(o =>
          '<tr>' +
            '<td style="font-family:monospace;font-size:12px">' + truncateId(o.id) + '</td>' +
            '<td>' + statusBadge(o.status) + '</td>' +
            '<td>' + formatCurrency(o.total) + '</td>' +
            '<td>' + (o.paymentMethod || 'N/A') + '</td>' +
            '<td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">' + (o.deliveryAddress || 'N/A') + '</td>' +
            '<td>' + formatDate(o.createdAt) + '</td>' +
          '</tr>'
        ).join('') +
        '</tbody></table>';
    }

    function renderRestaurants() {
      if (restaurantsData.length === 0) {
        document.getElementById('restaurants-grid').innerHTML = '<div class="empty-state" style="grid-column:1/-1"><p>No restaurants found</p></div>';
        return;
      }

      document.getElementById('restaurants-grid').innerHTML = restaurantsData.map(r => {
        const approved = r.isApproved !== false;
        const rating = r.rating ? parseFloat(r.rating).toFixed(1) : 'N/A';
        return '<div class="restaurant-card">' +
          '<div class="r-header">' +
            '<div><div class="r-name">' + (r.name || 'N/A') + '</div><div class="r-cuisine">' + (r.cuisineType || r.cuisine || 'N/A') + '</div></div>' +
            statusBadge(approved ? 'approved' : 'pending') +
          '</div>' +
          '<div class="r-stats">' +
            '<div><div class="r-stat-label">Rating</div><div class="r-stat-value">⭐ ' + rating + '</div></div>' +
            '<div><div class="r-stat-label">Orders</div><div class="r-stat-value">' + formatNumber(r.orderCount || 0) + '</div></div>' +
          '</div>' +
        '</div>';
      }).join('');
    }

    function renderDrivers() {
      if (driversData.length === 0) {
        document.getElementById('drivers-table').innerHTML = '<div class="empty-state"><p>No drivers found</p></div>';
        return;
      }

      document.getElementById('drivers-table').innerHTML =
        '<table><thead><tr><th>Name</th><th>Availability</th><th>Rating</th><th>Total Deliveries</th><th>Background Check</th></tr></thead><tbody>' +
        driversData.map(d => {
          const name = [d.firstName, d.lastName].filter(Boolean).join(' ') || 'N/A';
          const available = d.isAvailable;
          const rating = d.rating ? parseFloat(d.rating).toFixed(1) : 'N/A';
          const bgCheck = d.backgroundCheckStatus || 'pending';
          return '<tr>' +
            '<td>' + name + '</td>' +
            '<td>' + (available ? '<span class="badge badge-success">Available</span>' : '<span class="badge badge-neutral">Offline</span>') + '</td>' +
            '<td>⭐ ' + rating + '</td>' +
            '<td>' + formatNumber(d.totalDeliveries || 0) + '</td>' +
            '<td>' + statusBadge(bgCheck) + '</td>' +
          '</tr>';
        }).join('') +
        '</tbody></table>';
    }

    function renderCompliance() {
      if (!statsData || !statsData.compliance) {
        document.getElementById('compliance-logs').innerHTML = '<div class="empty-state"><p>No compliance data</p></div>';
        return;
      }

      const logs = statsData.compliance.recent || [];
      if (logs.length === 0) {
        document.getElementById('compliance-logs').innerHTML = '<div class="empty-state"><p>No compliance logs yet</p></div>';
        return;
      }

      document.getElementById('compliance-logs').innerHTML =
        '<div class="compliance-list">' +
        logs.map(log => {
          const dotColor = log.status === 'approved' ? 'green' : log.status === 'pending' ? 'yellow' : log.status === 'failed' ? 'red' : 'blue';
          const details = log.details || {};
          const description = details.action ? details.action.replace(/_/g, ' ') : log.type;
          return '<div class="compliance-item">' +
            '<span class="status-dot ' + dotColor + '"></span>' +
            '<div><div style="font-weight:500">' + (log.type || 'N/A').replace(/_/g, ' ') + '</div><div style="font-size:12px;color:var(--text-secondary)">' + description + '</div></div>' +
            '<div>' + statusBadge(log.status) + '</div>' +
            '<div style="font-size:12px;color:var(--text-secondary)">' + formatDate(log.createdAt) + '</div>' +
          '</div>';
        }).join('') +
        '</div>';
    }

    function renderBudget() {
      if (!statsData || !statsData.pilotBudget) return;
      const budget = statsData.pilotBudget;
      const total = budget.total;

      const categories = [
        { ...budget.driverGuarantees, color: '#00D4AA' },
        { ...budget.customerPromos, color: '#4D9DFF' },
        { ...budget.merchantIncentives, color: '#A855F7' },
        { ...budget.marketing, color: '#FFB84D' },
        { ...budget.operations, color: '#FF4D6A' },
        { ...budget.techHosting, color: '#6366F1' },
      ];

      document.getElementById('budget-total').textContent = formatCurrency(total);

      document.getElementById('budget-bars').innerHTML = categories.map(c => {
        const pct = (c.budget / total * 100).toFixed(1);
        return '<div class="budget-bar-item">' +
          '<div class="budget-bar-header">' +
            '<span class="bar-label">' + c.label + '</span>' +
            '<span class="bar-amount">' + formatCurrency(c.budget) + ' (' + pct + '%)</span>' +
          '</div>' +
          '<div class="budget-bar-track">' +
            '<div class="budget-bar-fill" style="width:' + pct + '%;background:' + c.color + '"></div>' +
          '</div>' +
        '</div>';
      }).join('');

      let cumulativePct = 0;
      const conicStops = categories.map(c => {
        const pct = c.budget / total * 100;
        const start = cumulativePct;
        cumulativePct += pct;
        return c.color + ' ' + start + '% ' + cumulativePct + '%';
      });

      document.getElementById('pie-chart-area').innerHTML =
        '<div class="pie-chart" style="background:conic-gradient(' + conicStops.join(', ') + ')"></div>' +
        '<div class="pie-legend">' +
        categories.map(c =>
          '<div class="pie-legend-item">' +
            '<div class="pie-legend-dot" style="background:' + c.color + '"></div>' +
            '<span>' + c.label + ' — ' + formatCurrency(c.budget) + '</span>' +
          '</div>'
        ).join('') +
        '</div>';
    }

    async function renderSettings() {
      const [services, health] = await Promise.all([
        apiFetch('/api/services/status'),
        apiFetch('/api/health'),
      ]);

      let html = '';

      if (health) {
        html += '<div class="card"><div class="card-title">System Health</div>';
        const items = [
          { label: 'Status', value: health.status || 'unknown' },
          { label: 'Uptime', value: health.uptime ? Math.floor(health.uptime / 60) + ' min' : 'N/A' },
          { label: 'Memory (RSS)', value: health.memory?.rss ? (health.memory.rss / 1024 / 1024).toFixed(1) + ' MB' : 'N/A' },
          { label: 'Memory (Heap Used)', value: health.memory?.heapUsed ? (health.memory.heapUsed / 1024 / 1024).toFixed(1) + ' MB' : 'N/A' },
        ];
        if (health.totalRequests) items.push({ label: 'Total Requests', value: formatNumber(health.totalRequests) });
        if (health.errorRate !== undefined) items.push({ label: 'Error Rate', value: (health.errorRate * 100).toFixed(2) + '%' });
        html += items.map(i =>
          '<div class="service-item"><span class="service-label">' + i.label + '</span><span>' + i.value + '</span></div>'
        ).join('');
        html += '</div>';
      }

      if (services) {
        html += '<div class="card"><div class="card-title">Payment Services</div>';
        html += '<div class="service-item"><span class="service-label">Stripe</span>' + statusBadge(services.payments?.stripe ? 'active' : 'pending') + '</div>';
        html += '<div class="service-item"><span class="service-label">Crypto</span>' + statusBadge(services.payments?.crypto ? 'active' : 'pending') + '</div>';
        html += '<div class="service-item"><span class="service-label">Escrow</span>' + statusBadge(services.payments?.escrow ? 'active' : 'pending') + '</div>';
        html += '</div>';

        html += '<div class="card"><div class="card-title">Notification Services</div>';
        html += '<div class="service-item"><span class="service-label">Email (SendGrid)</span>' + statusBadge(services.notifications?.email ? 'active' : 'pending') + '</div>';
        html += '<div class="service-item"><span class="service-label">SMS (Twilio)</span>' + statusBadge(services.notifications?.sms ? 'active' : 'pending') + '</div>';
        html += '<div class="service-item"><span class="service-label">Push</span>' + statusBadge(services.notifications?.push ? 'active' : 'pending') + '</div>';
        html += '</div>';

        html += '<div class="card"><div class="card-title">Verification & Tracking</div>';
        html += '<div class="service-item"><span class="service-label">Persona (ID)</span>' + statusBadge(services.verification?.persona ? 'active' : 'pending') + '</div>';
        html += '<div class="service-item"><span class="service-label">Checkr (BG)</span>' + statusBadge(services.verification?.checkr ? 'active' : 'pending') + '</div>';
        html += '<div class="service-item"><span class="service-label">GPS Tracking</span>' + statusBadge(services.tracking?.gps ? 'active' : 'pending') + '</div>';
        html += '<div class="service-item"><span class="service-label">Active Drivers</span><span>' + (services.tracking?.activeDrivers || 0) + '</span></div>';
        html += '</div>';

        if (services.cache) {
          html += '<div class="card"><div class="card-title">Cache Status</div>';
          html += '<div class="service-item"><span class="service-label">Hits</span><span>' + formatNumber(services.cache.hits || 0) + '</span></div>';
          html += '<div class="service-item"><span class="service-label">Misses</span><span>' + formatNumber(services.cache.misses || 0) + '</span></div>';
          html += '<div class="service-item"><span class="service-label">Size</span><span>' + formatNumber(services.cache.size || 0) + '</span></div>';
          html += '</div>';
        }

        html += '<div class="card"><div class="card-title">Blockchain</div>';
        html += '<div class="service-item"><span class="service-label">Network</span><span>' + (services.blockchain?.network || 'N/A') + '</span></div>';
        html += '<div class="service-item"><span class="service-label">NFT Contract</span><span style="font-family:monospace;font-size:11px;word-break:break-all">' + (services.blockchain?.nftContract || 'N/A') + '</span></div>';
        html += '<div class="service-item"><span class="service-label">Escrow Contract</span><span style="font-family:monospace;font-size:11px;word-break:break-all">' + (services.blockchain?.escrowContract || 'N/A') + '</span></div>';
        html += '</div>';
      }

      if (!html) {
        html = '<div class="empty-state" style="grid-column:1/-1"><p>Unable to load settings</p></div>';
      }

      document.getElementById('settings-content').innerHTML = html;
    }

    async function init() {
      await fetchAllData();
      refreshInterval = setInterval(fetchAllData, 30000);
    }
  </script>
</body>
</html>